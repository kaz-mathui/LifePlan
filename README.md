# LifePlan - æœªæ¥å®¶è¨ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ—ãƒª

å€‹äººã®ãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³ã«åŸºã¥ã„ãŸæœªæ¥ã®å®¶è¨ˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã€å¯è¦–åŒ–ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

## ğŸ“œ ç›®æ¬¡

- [âœ¨ æ¦‚è¦](#-æ¦‚è¦)
- [ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#ï¸-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
- [ğŸ’» ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º](#-ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º)
- [âœ… ãƒ†ã‚¹ãƒˆ](#-ãƒ†ã‚¹ãƒˆ)
- [ğŸš€ æœ¬ç•ªç’°å¢ƒï¼ˆAWSï¼‰](#-æœ¬ç•ªç’°å¢ƒaws)
- [ğŸ”„ CI/CD](#-cicd)
- [ğŸ”’ ç’°å¢ƒå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ](#-ç’°å¢ƒå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ)
- [ğŸ”® ä»Šå¾Œã®æ”¹å–„æ¡ˆ](#-ä»Šå¾Œã®æ”¹å–„æ¡ˆ)

## âœ¨ æ¦‚è¦

React (Create React App) ã¨ Node.js (Express) ã«ã‚ˆã‚‹ãƒ¢ãƒãƒ¬ãƒæ§‹æˆã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ã‚¤ãƒ³ãƒ•ãƒ©ã¯ Terraform ã§ã‚³ãƒ¼ãƒ‰ç®¡ç†ã•ã‚Œã€AWS ä¸Šã«æ§‹ç¯‰ã•ã‚Œã¾ã™ã€‚

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´**: ã‚¤ãƒ³ãƒ•ãƒ©ã‚’**æ°¸ç¶š** (`base`) ã¨**ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰** (`alb`) ã®2ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ†å‰²ã€‚é–‹ç™ºæ™‚é–“å¤–ã¯ `alb` ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆALB, ECSã‚µãƒ¼ãƒ“ã‚¹ç­‰ï¼‰ã‚’ `terraform destroy` ã™ã‚‹ã“ã¨ã§ã€ã‚³ã‚¹ãƒˆã‚’æœ€å°é™ã«æŠ‘ãˆã¾ã™ã€‚

```mermaid
graph TD
    subgraph "é–‹ç™ºè€…"
        A[Git Push to main]
    end

    subgraph "AWS CI/CD"
        A --> B(CodePipeline: Source)
        B --> C{CodeBuild}
        C -- ãƒ“ãƒ«ãƒ‰ & ECRã¸ãƒ—ãƒƒã‚·ãƒ¥ --> D[ECR]
        C -- ãƒ“ãƒ«ãƒ‰æƒ…å ±ã‚’S3ã¸ --> E[S3: ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ]
        E --> F(CodePipeline: Deploy)
    end

    subgraph "AWS æœ¬ç•ªç’°å¢ƒ"
        subgraph "base ãƒ¬ã‚¤ãƒ¤ãƒ¼ (æ°¸ç¶š)"
            D
            J[Route 53: Hosted Zone]
            L[VPC, Subnets, etc.]
            M[ECS Cluster]
            N[IAM Roles]
            O[Secrets Manager]
        end

        subgraph "alb ãƒ¬ã‚¤ãƒ¤ãƒ¼ (ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰)"
            G[ALB]
            H[ECS Fargate: Frontend]
            I[ECS Fargate: Backend]
            K[Route 53: A Record]
        end
        F -- ã‚µãƒ¼ãƒ“ã‚¹æ›´æ–° --> H & I
        O -- èª­è¾¼ --> C & I
    end
    
    subgraph "ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼"
        P[ãƒ¦ãƒ¼ã‚¶ãƒ¼]
    end

    P -- app.your-domain.com --> K --> G
    G -- ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ --> H & I
    I -- DBã‚¢ã‚¯ã‚»ã‚¹ --> Q((Firebase))
    P -- èªè¨¼ --> Q
```

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
| :--- | :--- |
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | React, TypeScript, Create React App, pnpm, Tailwind CSS, Chart.js |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** | Node.js, Express, TypeScript, pnpm, Zod |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | Google Firestore |
| **ã‚¤ãƒ³ãƒ•ãƒ©** | AWS (ECS Fargate, ALB, ECR, S3, Route 53), Terraform |
| **CI/CD** | AWS CodePipeline, AWS CodeBuild, GitHub Actions |

## ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
.
â”œâ”€â”€ .github/workflows/ci.yml # CI (ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ) ã®å®šç¾©
â”œâ”€â”€ backend/                 # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Node.js/Express)
â”œâ”€â”€ frontend/                # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (React/CRA)
â”œâ”€â”€ infra/
â”‚   â”œâ”€â”€ base/                # æ°¸ç¶šã‚¤ãƒ³ãƒ•ãƒ© (VPC, ECR, ECS Clusterãªã©)
â”‚   â””â”€â”€ alb/                 # ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ© (ALB, ECS Service, CI/CDãªã©)
â”œâ”€â”€ scripts/                 # ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ãƒ»åœæ­¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ pnpm-workspace.yaml
```

## ğŸ’» ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

**å‰æãƒ„ãƒ¼ãƒ«**: Node.js (v18+), pnpm (v8+), Docker

1.  **ãƒªãƒã‚¸ãƒˆãƒªã®æº–å‚™**:
    ```bash
    git clone <repository_url> && cd LifePlan && pnpm install
    ```

2.  **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**:
    å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `.env.example` ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€å†…å®¹ã‚’ç·¨é›†ã—ã¾ã™ã€‚
    - **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: `cp frontend/.env.example frontend/.env`
    - **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: `cp backend/.env.example backend/.env`
        - `SERVICE_ACCOUNT_KEY`ã«ã¯ã€Firebaseã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼JSONã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ–‡å­—åˆ—ã‚’è¨­å®šã—ã¾ã™ã€‚
        - `base64 -i path/to/serviceAccountKey.json | tr -d '\n'`

3.  **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•**:
    ```bash
    pnpm dev
    ```
    - **PCãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹**:
        - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `http://localhost:3000`
        - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: `http://localhost:3001`
    - **å®Ÿæ©Ÿï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ï¼‰ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹**:
        1. PCã®ãƒ­ãƒ¼ã‚«ãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ã¾ã™ (`ipconfig getifaddr en0` ãªã©)ã€‚
        2. `frontend/.env` ã« `REACT_APP_BACKEND_URL=http://<ã‚ãªãŸã®PCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹>:3001` ã‚’è¨­å®šã—ã¾ã™ã€‚
        3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¾ã™ (`pnpm dev`)ã€‚
        4. ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ `http://<ã‚ãªãŸã®PCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹>:3000` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

4.  **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®åœæ­¢**:
    ```bash
    pnpm dev:down
    ```

## âœ… ãƒ†ã‚¹ãƒˆ

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vitest)**:
  ```bash
  # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
  pnpm --filter lifeplan-frontend test
  # UIãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
  pnpm --filter lifeplan-frontend test:ui
  ```
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Jest)**:
  ```bash
  # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
  pnpm --filter lifeplan-backend test
  ```

## ğŸš€ æœ¬ç•ªç’°å¢ƒï¼ˆAWSï¼‰

**å‰æ**: AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ, AWS CLI, å–å¾—æ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³, Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ, GitHubãƒªãƒã‚¸ãƒˆãƒª

1.  **æ°¸ç¶šã‚¤ãƒ³ãƒ•ãƒ© (`base`) ã®ãƒ‡ãƒ—ãƒ­ã‚¤**:
    1.  **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç™»éŒ²**: AWS Secrets Managerã« `prd/life-plan-app/firebase` (Firebaseã‚­ãƒ¼JSON) ã¨ `dockerhub/credentials` (DockerHubã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³) ã‚’ä½œæˆã—ã¾ã™ã€‚
    2.  **å¤‰æ•°è¨­å®š**: `infra/base/terraform.tfvars` ã« `domain_name` ã‚’è¨­å®šã—ã¾ã™ã€‚
    3.  **é©ç”¨**: `cd infra/base && terraform init && terraform apply` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

2.  **ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ© (`alb`) ã®ãƒ‡ãƒ—ãƒ­ã‚¤**:
    1.  **å¤‰æ•°è¨­å®š**: `infra/alb/terraform.tfvars` ã« `domain_name`, `subdomain_name`, `dockerhub_username` ã‚’è¨­å®šã—ã¾ã™ã€‚
    2.  **é©ç”¨**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§ `./scripts/start_services.sh` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    3.  **æ‰¿èª**: AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã® `CodeStar Connections` ã§ä¿ç•™ä¸­ã®æ¥ç¶šã‚’æ‰¿èªã—ã¾ã™ã€‚
    4.  **åˆå›å®Ÿè¡Œ**: AWS `CodePipeline` ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ‰‹å‹•ã§åˆå›å®Ÿè¡Œã—ã¾ã™ã€‚

**é‹ç”¨ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰**:
- **åœæ­¢**: `./scripts/stop_services.sh` (`alb` ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ `destroy`)
- **èµ·å‹•**: `./scripts/start_services.sh` (`alb` ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ `apply`)

## ğŸ”„ CI/CD

- **CI (Pull Requestæ™‚)**: GitHub ActionsãŒ `main` ãƒ–ãƒ©ãƒ³ãƒã¸ã®PRã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã€å…¨ãƒ†ã‚¹ãƒˆã¨ãƒ“ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¾ã™ã€‚ (`.github/workflows/ci.yml`)
- **CD (Mergeæ™‚)**: PRãŒãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã¨ã€AWS CodePipelineãŒ `main` ãƒ–ãƒ©ãƒ³ãƒã®æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’æ¤œçŸ¥ã—ã€ãƒ“ãƒ«ãƒ‰â†’ECRã¸ãƒ—ãƒƒã‚·ãƒ¥â†’ECSã¸ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã€ã¨ã„ã†ä¸€é€£ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚

## ğŸ”’ ç’°å¢ƒå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

| ç’°å¢ƒ | è¨­å®šå ´æ‰€ | è©³ç´° |
|:---|:---|:---|
| **ãƒ­ãƒ¼ã‚«ãƒ«** | `frontend/.env`, `backend/.env` | `docker-compose.yml` ã«ã‚ˆã‚Šå„ã‚³ãƒ³ãƒ†ãƒŠã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚ |
| **æœ¬ç•ª** | AWS Secrets Manager, CodeBuild Env | Terraformã‚³ãƒ¼ãƒ‰ã«ã¯ç§˜å¯†æƒ…å ±ã‚’å«ã¾ãšã€IAMãƒ­ãƒ¼ãƒ«çµŒç”±ã§å®‰å…¨ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚ |

## ğŸ”® ä»Šå¾Œã®æ”¹å–„æ¡ˆ

- Terraform Stateã®S3ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®ç§»è¡Œ
- ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã®æ§‹ç¯‰
- CloudWatchã«ã‚ˆã‚‹ç›£è¦–ä½“åˆ¶ã®å¼·åŒ–
- HTTPSå¯¾å¿œ (ALBã¸ã®ACMè¨¼æ˜æ›¸å‰²å½“)
